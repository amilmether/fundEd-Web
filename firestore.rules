rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Allow public read access for the payment page
    match /classes/{classId} {
      // Allow reading a specific event
      match /events/{eventId} {
        allow get: if true;
      }

      // Allow listing all students for a class
      match /students/{studentId} {
        allow read: if true; // Allows get and list
      }

      // Allow listing payments for an event and creating new ones
      match /payments/{paymentId} {
        allow read: if true; // Allows get and list
        allow create: if true;
      }
    }
    
    // Authenticated reps/admins can manage all data within their class
    match /classes/{classId}/{document=**} {
      allow read, write: if request.auth != null; // Simple rule: must be logged in
    }

    // Fallback to deny all other access
    match /{path=**} {
      allow read, write: if false;
    }
  }
}
